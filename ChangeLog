2000-04-11  John Jannotti  <jj@lcs.mit.edu>

	* tnt.el (tnt-shutdown): Changed name from tnt-buddy-shutdown as
	it has become a catchall for all shutdown realted stuff.  tnt-kill 
	and tnt-handle-close had some duplicated code that I put here
	because, inevitably, someone would put some shutdown stuff in one
	but not the other.
	(tnt-repeat): Added.  Sets up a repeating timer in a way that
	XEmacs (and Emacs) likes.  Made it its own function because
	interval has to be the first and second arg to run-at-time, which
	looks ugly.
	(tnt-buggy-idle): Added a variable tnt-buggy-idle which helps
	control whether we do idle handling.  It defaults to t so we do
	not do idle handling.  It should be some sort of complicated test
	to see if the bug exists.  For now, to override it, you must set
	it to nil *before* loading tnt.el since it controls the default
	setting of a later variable.
	(tnt-im-mode): Use syntax-table and abbrev-table from text-mode.
	(tnt-chat-mode): Use syntax-table and abbrev-table from text-mode.
	(tnt-buddy-list-mode): Use syntax-table from text-mode.
	(tnt-buddy-edit-mode): Use syntax-table from text-mode.
	

2000-04-10  Neil ''Fred'' Picciotto  <fred@guido.derf.net>

	* tnt.el (tnt-handle-closed): now checking whether unidle-timer
	exists before canceling it, rather than when idle-timer exists.
	(tnt-handle-sign-on): uncommented out the unidle-timer.
	use-idle-timer is still defaulting to nil, so this doesn't really
	need to be commented out.
	(tnt-timers-available): added.  checks (fboundp 'run-at-time).
	(tnt-use-keepalive): now defaults to timers-available.
	(tnt-use-buddy-update-timer): now defaults to timers-available.
	(tnt-use-idle-timer): changed the note in the doc string to better
	describe the current bug.
	(tnt-email-binary): just made the doc string more grammatical and
	informative.

	* toc.el (toc-handle-receive): just fixed some whitespace.  i
	guess i'm as anal as john.

2000-04-07  Neil ''Fred'' Picciotto  <fred@guido.derf.net>

	* tnt.el (tnt-send-idle): added.
	(tnt-send-unidle): added.  (currently does not get called properly
	when you become unidle.)
	(tnt-use-buddy-update-timer): added.
	(tnt-use-idle-timer): added.  (currently defaults to nil, because
	becoming unidle is not yet supported.)
	(tnt-idle-timer): added.
	(tnt-send-idle-after): added.
	(tnt-unidle-timer): added.
	(tnt-send-unidle-after): added.
	(tnt-currently-idle): added.
	(tnt-buddy-update-timer): added.
	(tnt-buddy-update-interval): added.
	(tnt-keepalive): now using a repeating timer object, rather than
	creating a new one each time.  for one thing, before we would have
	been unable to cancel the timer if we log out or get disco'ed
	before the first time it ran.  also there's no point in allocating
	a new object every minute...
	(tnt-handle-closed): now cancelling all the timers.  also,
	checking whether the timer itself is non-nil rather than whether
	the "use" variable is non-nil.
	(tnt-handle-sign-on): now creating timers for updating the
	*buddies* buffer and for telling the server we've been idle.

2000-04-07  Neil ''Fred'' Picciotto  <fred@guido.derf.net>

	* tnt.el (tnt-buddy-idle): now returning a string of the form
	"1h12m" or "34m".  
	(tnt-build-buddy-buffer): since idle is now a string, we can't
	compare it to 0, but if it's not nil, it should always be a string
	to display.  also, changed a complicated nesting of ifs into an
	equivalent but simpler cond.
	(tnt-buddy-list-mode-map): hitting space in the *buddies* buffer
	now causes it to refresh idle times.

2000-04-07  Neil ''Fred'' Picciotto  <fred@guido.derf.net>

	* tnt.el (tnt-show-buddies): changed apply to funcall
	(tnt-set-buddy-status): now storing the time the buddy became
	idle, rather than the amount of time they've been idle.
	(tnt-buddy-idle): now computing the time they've been idle based
	on when they became idle.
	(tnt-build-buddy-buffer): now making sure idle is non-nil before
	comparing it to 0.

2000-04-06  John Jannotti  <jj@lcs.mit.edu>

	* toc.el (toc-handle-receive): Fix some indentation.  Sorry I'm so 
	anal.
	(toc-normalize): Try, try again.  Rewrote much more simply, maybe
	faster.  This time it definitely works in both Emacs and XEmacs.

	* tnt.el (tnt-handle-goto-url): Added
	(tnt-open): bind the goto-url function to tnt-handle-goto-url

	* toc.el: Reorganized to reflect the ordering of documentation in
 	PROTOCOL
	(toc-evil): Added
	(toc-add-permits): Added
	(toc-add-denies): Added
	(toc-chat-evil): Added
	(toc-get-info): Added
	(toc-set-info): Added
	(toc-set-idle): Added
	(toc-handle-receive): Stop sending cmd for GOTO_URL, since we now
	handle it correctly.

	* tnt.el (tnt-handle-error): Added catchall clause to notice weird
 	errors

2000-04-06  Neil ''Fred'' Picciotto  <fred@guido.derf.net>

	* tnt.el (tnt-leave-chat): now using completing-read with
	the list of chats you're in (the cdrs from tnt-chat-alist)
	(tnt-online-buddies-collection): changed name from
	tnt-buddy-collection, so that it's clear that this gives just the
	buddies who are currently online.
	(tnt-send-text-as-chat-invitation): added (completion-ignore-case t)
	(tnt-send-text-as-chat-whisper): added (completion-ignore-case t)

	* README: added tnt-leave-chat info.

2000-04-06  John Jannotti  <jj@lcs.mit.edu>

	* tnt.el (tnt-inhibit-key-bindings): Added keybinding for
 	tnt-leave-chat.
	(tnt-show-help): Added help for tnt-leave-chat
	(tnt-chat-buffer-name): Made comment into docstring
	(tnt-chat-buffer): Made comment into docstring

	* toc.el (toc-chat-invite): Made the &rest parameter a normal
 	parameter so we wouldn't need to use apply when we have built a
 	list of buddies to invite.

	* tnt.el (tnt-join-chat): Better docstring
	(tnt-handle-chat-join): Tiny simplification
	(tnt-append-message): Significant interface change.  User now
	comes after message and is optional so if it is not needed it can
	be left out, not sent as nil.  More significantly, a new optional
	argument MODIFIED is used for the various parenthetical comments
	made about some messages, such as Auto-response, whispers,
	invites, etc.  This is so that the coloring mechanism gets to look 
	at the unadorned username.  Now when I whisper to someone in a
	chat room it will still be printed in my color.

2000-04-05  John Jannotti  <jj@lcs.mit.edu>

	* tnt.el (tnt-chat-leave): Allows quitting a chat without killing
 	the buffer.
	(tnt-join-chat): tnt-join-chat nows joins the chat associated with
 	the current buffer if there is one.
	(tnt-chat-buffer-killed): Uses tnt-chat-leave
	(tnt-handle-eviled): handle the eviled message (untested, no client)

	* PROTOCOL: Neatened up so everything it fits in 80 columns

	* toc.el (toc-handle-receive): Added code for all the messages
 	that we don't handle yet.  For the moment I've hooked all except
 	'eviled' up to tnt-debug which logs the message in a buffer called
 	"*tnt-debug*".  For release they should be hooked up to some
 	ignore function (unless we actually use them)  Also moved the
	clauses that decipher the type of messages so that they are in the 
	same order as the messages are described in PROTOCOL.
	

2000-04-05 John Jannotti <jj@lcs.mit.edu>

	* tocstr.el (tocstr-init-receiver): Reset flap-state when opening
	the toc connection since state could be strange due to an
	ill-timed tnt-kill.

	* toc.el (toc-keepalive): Created to keep tocstr functions out of
	tnt.el

2000-04-04 Neil "Fred" Picciotto

	* tnt.el: moved defvars for tnt-pipe-to-email-now and
	tnt-buddy-blist up near the top, to eliminate "reference to free
	variable" byte-compile errors.

2000-04-04 Jim Whitehead

	* Makefile: Added. Targets are "elc" to bytecompile all files and
 	"release" to build a tar file of a release.

2000-04-04 Neil "Fred" Picciotto

	* tnt.el: synchronized help info between the text block displayed
	by "C-x t ?"  and that in the README.

	* README: added explanations of tnt-show-help, tnt-switch-user,
 	and tnt-toggle-email.

	* tnt.el: if *tnt-help* buffer already exists, tnt-show-help now
	switches to it

	* INSTALL: removed line which said that it had only been tested in
 	emacs 19.34, replaced it with line from README about the versions
 	it's been tested in.

2000-04-03 Jim Whitehead

	* tnt.el: tnt-show-timestamps has been renamed to
 	tnt-use-timestamps to go with our naming conventions
	
	* tnt.el (tnt-handle-closed): added a mail-pipe in to notify you
 	that your connection has been closed (by the server, or by remote
 	signon).

2000-04-01 Jim Whitehead

	* tnt.el (tnt-get-away-msg): Small change to fix a possible error
 	with trying to send a nil away message.

2000-04-01 Neil "Fred" Picciotto

	* tnt.el: removed tnt-default-username-list variable, replaced it
	with a new tnt-username-alist variable, which assocs usernames
	with passwords.  Explained in INSTALL.

	* tnt.el (tnt-pounce-delete): was using "remassoc" which didn't
	compile for me; perhaps this was another XEmacs-ism?  in any case,
	wrote tnt-remassoc to remove an assoc from an alist.

	* tnt.el: removed some tab characters that were still lying around
	in tnt.el.

2000-03-31 Jim Whitehead

	* tnt.el: Bugfix to fix the "no process" mesasges, due to
	incorrect calls in tnt-buddy-shutdown

	* tnt.el: Broke alot of fixed code in order to keep the project
	compatable with GNU emacs.  (replace-in-string) is not standard,
	and therefore breaks all over the place with GNU.  This affects:
	tnt-strip-a-href and tnt-strip-html in tnt.el and toc-encode and
	toc-normalize These have been reverted to their orginal versions.

	* tnt.el (tnt-set-buddy-status): There was a problem with the
 	changes to tnt-away, etc where (away) is not being appended to the
 	buddy list for any away buddies.  This has been fixed.

2000-03-31 John Jannotti <jj@lcs.mit.edu>

	* tnt.el (tnt-pounce-delete): Simplified pounce deletion to just
 	one function, picked tnt-pounce-delete as the "survivor". (Note
 	this is user visable, but barely)

	* tnt.el (tnt-addassoc): Simplified a lot of code by adding
 	tnt-addassoc and using it.

	* tnt.el: renamed tnt-pounce-list to tnt-pounce-alist for
	consistency

	* tnt.el: Made tnt-away and tnt-away-alist use t/nil instead of
	1/0.  This simplifies a lot of code that uses them.

	* toc.el (toc-set-away): Fixed a typo, so now tnt.el doesn't need
 	to call tocstr-send directly anymore.
 	(toc-{add,remove}-buddy): change names, simplify interface
	(tnt-show-help): funcall (switch-buffer-function), not apply
 	(tnt-keepalive): use tocstr-send-flap, not tocstr-send-flap1
 	(tnt-rotate-{left,right}): Simplified, sped up and docstringed.

	* tnt.el: Used emacs primitives instead of complicated code to
	simplify toc-encode, toc-normalize, tnt-strip-html,
	tnt-strip-a-href, and tnt-completing-read-list

	* tnt.el: Added tnt-separator variable

	* tnt.el (tnt-send-away-msg): Was called send-away-msg.
	(tnt-show-chat-participants, tnt-handle-chat-update-buddy): Use
 	identity in calls to mapcar.
	(tnt-set-buddy-status): removed format when using message
	(tnt-pounce-add): removed format when using message
	(tnt-switch-user): removed format when using message
	(tnt-participant-collection): use 'list in mapcar call
	(tnt-buddy-status): Simplify
	(tnt-buddy-idle): Simplify
	(tnt-buddy-away): Simplify
	(tnt-set-buddy-status): Eliminated unused old-idle and old-away
 	bindings.

2000-03-30 Jim Whitehead

	* tnt.el: added a user-defined variable to avoid needing to hack
	the code if your mail executable isn't in /bin/mail.
	tnt-email-binary.

	* tnt.el (tnt-shutdown): fixed so it properly disposes of
 	client-side away messages.

	* tnt.el: piping IMs to an email now prints a reminder message.
	It may be beneficial to add a modeline change, but I don't have
	time today.


2000-03-29 Neil "Fred" Picciotto

	* tnt.el: made piping to email simpler to configure (i.e. just set
	some variables, rather than having to go in and change the code)

	* tnt.el (pounce-add): tab-complete based on all buddies, rather
 	than just those that are currently online

	* tnt.el (pounce-del): tab-complete based on pounce-list, rather
 	than online buddies

	* tnt.el: moved a few bits of code around within the file (defvars
 	of user-configurable variables all together at top,
 	tnt-switch-user near tnt-open, and so on)

	* tnt.el: you can now hit C-g (or just return with no password) to
	get out of the password prompt

	* tnt.el: added config var for beeping when buddies sign on and
	off

	* tnt.el: fixed miscellaneous typos, etc

	* INSTALL: explanations for all the user-configurable variables

2000-03-27 Jim Whitehead

	* tnt.el (tnt-keepalive): Added an option to avoid conflicts with
 	XEmacs enable with (setq tnt-use-keepalive t).

2000-03-28 Scott Evans

	* tnt.el: Made the recentering of the buffer optional.. it
	defaults to the current behavior.

	* tnt.el: Buddy entrances/exits are now displayed in the
	minibuffer

	* tnt.el: Code patch to change color of incoming user text when in
	a color environment.

	* tnt.el: Added a default away message, and a history.

	* tnt.el (tnt-im-buddy): Fixed regexp

2000-03-24 Jim Whitehead

	* tnt.el: Keepalive packets are now sent to the server, improving
	uptime.

	* tnt.el: Fixed sending of nil messages, which would crash other
	clients	(older versions of Everbuddy, etc)

	* tnt.el: Pounce Package

	* tnt.el: Better away status checking

	* tnt.el: Numerous other minor bugfixes

2000-03-24 Scott Evans

	* tnt.el: Code patch to remove nil entries in the auto-completion
	list for screennames

	* tnt.el (tnt-get-input-message): Was killing the region, instead
 	of deleting it, which hosed the kill ring.

2000-03-24 Allan Poindexter

	* tnt.el: Code snippet to show away status in modeline.

2000-03-24 Neil Picciotto

	* tnt.el: Added a binding to the tnt-show-help command (C-x t ?)

	* tnt.el: Links are now displayed rather than being stripped.

	* tnt.el: Timestamps package has been added.

	* tnt.el: Beeping only happens when you are not in the im buffer
	of the person who is iming you.

	* tnt.el: Buddy list automagically comes up when you signon.
	Also, if the option is set, (see INSTALL) the screen splits when
	the buddy list is displayed.

	* tnt.el: Return does the same as i in the buddy list, namely
	initiating an IM.

	* tnt.el: Mouse clicking a screenname now initiates an IM.

	* tnt.el: You can now cycle through a list of screennames to sign
	on as.

	* tnt.el: Option (involving code change) that allows you to have
	all your IM's piped to a commandline.
